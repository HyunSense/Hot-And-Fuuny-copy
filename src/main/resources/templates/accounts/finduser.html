<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- font awesome cdn -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <!-- bootstrap cdn -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- common.css -->
    <link rel="stylesheet" href="../../static/css/common.css" th:href="@{/css/common.css}">
    <!-- login.css -->
    <link rel="stylesheet" href="../../static/css/login.css" th:href="@{/css/login.css}">

    <title>사용자 아이디/비밀번호 찾기</title>
</head>
<body id="securityBody">
    
    <!-- content -->
    <section class="h-100">
        <div class="container px-5 h-100">
            <div class="row h-100 d-flex justify-content-center align-items-center">
                
                <div class="col-12 col-md-8 col-lg-6 col-xl-5">
                    <div class="card shadow-lg" >

                        <div class="card-body p-4 shadow-lg text-center">

                            <!-- 아이디/비밀번호 찾기 선택 버튼 -->
                            <ul id="findBoxSelecter" class="mb-5">
                                <li class="bg-primary" id="findUserIdBtn">아이디 찾기</li>
                                <li class="bg-primary" id="findUserPwBtn">비밀번호 찾기</li>
                            </ul>

                            <!-- 홈으로 돌아가기 로고 -->
                            <a href="/index.html" th:href="@{/}">
                                <img src="/static/img/concert_logo_final2_black1.png" alt="logo"
                                th:src="@{/img/concert_logo_final2_black1.png}">
                            </a>
                            
                            <!-- 아이디 찾기 -->
                            <form method="post" id="findUserId" onsubmit="">
                                
                                <h4 class="mt-5" style="color: black;">로그인 아이디 찾기</h4>
                                <p class="mt-1">가입하셨던 이메일을 입력해주세요.</p>
                                
                                <!-- 기존 사용자 이메일 -->
                                <div class="text-start">
                                    <label class="form-label m-2" for="user_email">이메일</label>
                                    <input type="email" class="form-control form-control-lg " id="user_email"
                                    autocomplete="off" placeholder="user@gmail.com"/>
                                </div>
                                
                                <div class="findBtnBox">
                                    <button class="btn btn-lg m-3 border-0" type="button" id="findIdBtn">Send</button>
                                </div>

                            </form>
                            
                            <!-- 비밀번호 찾기 -->
                            <form method="post" id="findUserPassword">
                                
                                <h4 class="mt-5" style="color: black;">로그인 비빌번호 찾기</h4>
                                <p class="mt-1">
                                    양식을 모두 입력해주세요. <br>
                                </p>
                                
                                <!-- 기존 사용자 이메일 -->
                                <div class="text-start">
                                    <label class="form-label m-2" for="user_id">이메일</label>
                                    <input type="email" class="form-control form-control-lg " id="user_id"
                                    autocomplete="off" placeholder="user@gmail.com"/>
                                </div>
                                <!-- 기존 사용자 이름 -->
                                <div class="text-start">
                                    <label class="form-label m-2" for="user_name">이름</label>
                                    <input type="email" class="form-control form-control-lg " id="user_name"
                                    autocomplete="off" placeholder="Name"/>
                                </div>
                                <!-- 기존 사용자 전화번호 -->
                                <div class="text-start">
                                    <label class="form-label m-2" for="user_tel">연락처</label>
                                    <input type="text" class="form-control form-control-lg " id="user_tel"
                                    autocomplete="off" placeholder="Tel 010-0000-0000"/>
                                </div>

                                <div class="findBtnBox">
                                    <button class="btn btn-lg m-3 border-0" type="button" id="findPwBtn">send</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    
    <!-- bootstrap.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- finduser js -->
    <script src="../../static/js/finduser.js" th:src="@{/js/finduser.js}"></script>

<script>
    // 아이디 찾기 버튼 클릭 시
    document.getElementById('findIdBtn').addEventListener('click', function () {
        let userEmail = document.getElementById('user_email').value;

        // AJAX 요청을 수행하고 서버로 userEmail을 전송
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/user/findId', true);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    // 성공적으로 아이디를 찾았을 때의 처리
                    alert('존재하는 회원 아이디 입니다. ');
                }
                else if (xhr.status === 400) {
                    // 아이디를 찾지 못했을 때의 처리
                    alert('양식을 채워 주세요.');
                }
                else {
                    alert('아이디를 찾을 수 없습니다.')
                }
            }
        };
        // dto의 멤버와 자동파싱되도록 같은 이름으로.
        xhr.send(JSON.stringify({ loginId : userEmail }));
    });

    // 비밀번호 찾기 버튼 클릭 시
    document.getElementById('findPwBtn').addEventListener('click', function () {
        const userId = document.getElementById('user_id').value;
        const userName = document.getElementById('user_name').value;
        const userTel = document.getElementById('user_tel').value;

        // AJAX 요청을 수행하고 서버로 userId, userName, userTel을 전송
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/user/findPw', true);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    // 성공적으로 비밀번호를 찾았을 때의 처리
                    // const response = JSON.parse(xhr.responseText);
                    alert('비밀번호 재설정을 진행하겠습니다.');
                    window.location="/user/reset";
                }
                else if(xhr.status === 400) {
                    // 비밀번호를 찾지 못했을 때의 처리
                    alert('모든 양식을 채워 주세요.');
                }
                else {
                    alert('검색되는 회원을 찾을 수 없습니다.')
                }
            }
        };

        xhr.send(JSON.stringify({ loginId: userId, name: userName, tel: userTel }));
    });


</script>

</body>
</html>